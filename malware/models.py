from __future__ import unicode_literals

from django.db import models
from django.shortcuts import get_object_or_404

from hosts.models import Host
from hosts.models import Subnet

# Create your models here.

class Malware(models.Model):
    """Model for malware info"""
    alert_id = models.CharField(max_length=90)
    alert_type = models.CharField(max_length=80)
    file_name = models.CharField(max_length=80)
    computer = models.CharField(max_length=80)
    contact_group = models.CharField(max_length=80)
    virus = models.CharField(max_length=80)
    actual_action = models.CharField(max_length=80)
    comment = models.CharField(max_length=100)
    numeric_ip = models.GenericIPAddressField(protocol='ipv4', default='0.0.0.0')


    def __str__(self):
        return "%s, %s" % (self.alert_id, self.alert_type, self.file_name, self.computer, self.numeric_ip, self.comment)


    def get_host_id(self):
        """Returns the id of the Subnet that the Host belongs to."""
        ip = self.numeric_ip
        host = get_object_or_404(Host, ipv4_address=ip)
        host_id = host.id
        return host_id


    def get_subnet_id(self):
        """Returns the id of the Subnet that the Host belongs to."""
        ip = self.numeric_ip
        ip_prefix = ip.rsplit('.', 1)[0]
        subnet = get_object_or_404(Subnet, ipv4_address__startswith=ip_prefix)
        subnet_id = subnet.id
        return subnet_id


    host_id = property(get_host_id)
    subnet_id = property(get_subnet_id)
